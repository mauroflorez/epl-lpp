<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPL Score Predictor</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            padding: 1.5rem;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            background-color: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #37003c;
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        h2 {
            color: #37003c;
            font-size: 1.1rem;
            margin: 0 0 0.5rem 0;
        }

        .matchday-badge {
            display: inline-block;
            background: linear-gradient(135deg, #37003c 0%, #00ff85 100%);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-left: 0.3rem;
        }

        /* Two Column Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .column {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th,
        td {
            padding: 0.5rem 0.4rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            font-size: 0.8rem;
            color: #555;
        }

        .score {
            font-weight: bold;
            color: #37003c;
        }

        .actual-score {
            font-weight: bold;
            color: #007bff;
        }

        .pending {
            color: #999;
            font-style: italic;
        }

        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .clickable-row:hover {
            background-color: #f0f7ff;
        }

        /* Accuracy Banner */
        .accuracy-box {
            text-align: center;
            padding: 0.8rem;
            background: linear-gradient(135deg, #37003c 0%, #00ff85 100%);
            border-radius: 8px;
            color: white;
        }

        /* Heatmap Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-header h3 {
            margin: 0;
            color: #37003c;
            font-size: 1rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #999;
        }

        .heatmap {
            display: grid;
            grid-template-columns: 30px repeat(6, 1fr);
            gap: 2px;
            font-size: 0.75rem;
        }

        .heatmap-cell {
            padding: 6px 2px;
            text-align: center;
            border-radius: 3px;
            font-weight: 500;
        }

        .heatmap-header {
            background: #37003c;
            color: white;
            font-weight: 600;
        }

        .heatmap-row-header {
            background: #00ff85;
            color: #37003c;
            font-weight: 600;
        }

        .heatmap-label {
            font-size: 0.75rem;
            color: #666;
            text-align: center;
            margin-top: 0.3rem;
        }

        .info-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #37003c;
            font-size: 0.85rem;
        }

        .info-section h3 {
            color: #37003c;
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .info-section p {
            color: #666;
            line-height: 1.5;
            margin: 0;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>‚öΩ Premier League Predictions</h1>

        <div class="accuracy-box">
            <span>Winner Prediction Accuracy:</span>
            <span id="accuracy-value"
                style="font-size: 1.3rem; font-weight: bold; margin-left: 0.5rem;">Loading...</span>
            <span id="accuracy-detail" style="font-size: 0.85rem; margin-left: 0.5rem; opacity: 0.9;"></span>
        </div>

        <div class="grid">
            <!-- Left: Last Matchday -->
            <div class="column">
                <h2>üìä Last Matchday <span class="matchday-badge" id="past-matchday-badge">#23</span></h2>
                <table id="past-table">
                    <thead>
                        <tr>
                            <th>Match</th>
                            <th>Pred</th>
                            <th>H/D/A %</th>
                            <th>Actual</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Right: Current Matchday -->
            <div class="column">
                <h2>üîÆ Current Matchday <span class="matchday-badge" id="current-matchday-badge">#24</span></h2>
                <p style="font-size: 0.75rem; color: #888; margin: -0.3rem 0 0.5rem 0;">Click row for heatmap</p>
                <table id="current-table">
                    <thead>
                        <tr>
                            <th>Match</th>
                            <th>Date</th>
                            <th>Pred</th>
                            <th>H/D/A %</th>
                            <th>Actual</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="last-updated" style="color: #999; font-size: 0.8rem; margin-top: 1rem; text-align: center;"></div>

        <div class="info-section">
            <h3>üìà How It Works</h3>
            <p>
                Our <strong>Poisson regression model</strong> predicts expected goals (xG) for each team.
                The H/D/A % shows the probability of Home Win / Draw / Away Win based on the Poisson distribution.
                Click any current matchday row to see the detailed scoreline probability heatmap.
            </p>

            <h3 style="margin-top: 1rem;">‚öΩ Model Features</h3>
            <ul style="color: #666; margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.6;">
                <li><strong>Team Attack Strength:</strong> How many goals a team typically scores</li>
                <li><strong>Team Defensive Weakness:</strong> How many goals they typically concede</li>
                <li><strong>League Position:</strong> Current standings in the table</li>
                <li><strong>Rolling Stats:</strong> Goals, shots, and shots on target (last 5 games)</li>
                <li><strong>Home Advantage:</strong> Teams perform better at home on average</li>
            </ul>

            <h3 style="margin-top: 1rem;">üìä Understanding xG</h3>
            <p>
                Expected Goals (xG) represents the average number of goals a team would score given the match
                conditions.
                Since we use a Poisson distribution, xG is never exactly 0 - even weak teams have some probability of
                scoring.
                The probability heatmap shows the likelihood of each specific scoreline (e.g., 1-0, 2-1, etc.).
            </p>

            <p style="color: #999; font-size: 0.8rem; margin-top: 1rem; font-style: italic;">
                ‚ö†Ô∏è This is an experimental project for learning purposes. Predictions are not guaranteed to be accurate.
            </p>
        </div>
    </div>

    <!-- Heatmap Modal -->
    <div class="modal-overlay" id="heatmap-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Probability Heatmap</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="heatmap-label"><strong>Away Goals ‚Üí</strong></div>
            <div class="heatmap" id="heatmap-grid"></div>
            <div class="heatmap-label"><strong>‚Üë Home Goals</strong></div>
        </div>
    </div>

    <script>
        let currentMatchdayData = [];

        async function loadData() {
            try {
                // Load Current Matchday Predictions
                const predResponse = await fetch('predictions.json');
                if (predResponse.ok) {
                    const data = await predResponse.json();
                    currentMatchdayData = data.predictions || data;
                    const matchday = data.matchday || '24';
                    document.getElementById('current-matchday-badge').textContent = `#${matchday}`;
                    populateCurrentTable(currentMatchdayData);
                }

                // Load Past Results
                const resultResponse = await fetch('past_results.json');
                if (resultResponse.ok) {
                    const data = await resultResponse.json();
                    const results = data.results || data;
                    const matchday = data.matchday || '23';
                    document.getElementById('past-matchday-badge').textContent = `#${matchday}`;
                    populatePastTable(results);
                }

                // Load Accuracy
                const accResponse = await fetch('accuracy.json');
                if (accResponse.ok) {
                    const acc = await accResponse.json();
                    document.getElementById('accuracy-value').textContent = acc.accuracy + '%';
                    document.getElementById('accuracy-detail').textContent =
                        `(${acc.correct}/${acc.evaluated} correct)`;
                } else {
                    document.getElementById('accuracy-value').textContent = 'N/A';
                }

                document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleString()}`;
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr + 'T12:00:00');
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            return `${day}/${month}`;
        }

        function formatWinProbs(winProbs) {
            if (!winProbs) return '<span style="color:#999;">-</span>';
            const h = winProbs.H;
            const d = winProbs.D;
            const a = winProbs.A;
            const maxProb = Math.max(h, d, a);
            const hStyle = h === maxProb ? 'font-weight:bold;color:#28a745;' : 'color:#888;';
            const dStyle = d === maxProb ? 'font-weight:bold;color:#ffc107;' : 'color:#888;';
            const aStyle = a === maxProb ? 'font-weight:bold;color:#dc3545;' : 'color:#888;';
            return `<span style="${hStyle}">${h}</span>/<span style="${dStyle}">${d}</span>/<span style="${aStyle}">${a}</span>`;
        }

        function populatePastTable(data) {
            const tableBody = document.querySelector('#past-table tbody');
            tableBody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');
                const home = item.Home || item.HomeTeam;
                const away = item.Away || item.AwayTeam;

                row.innerHTML = `
                    <td>${home} vs ${away}</td>
                    <td class="score">${item.PredictedScore || '-'}</td>
                    <td style="font-size:0.8em;">${formatWinProbs(item.WinProbs)}</td>
                    <td class="actual-score">${item.Actual || item.ActualScore || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function populateCurrentTable(data) {
            const tableBody = document.querySelector('#current-table tbody');
            tableBody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showHeatmap(index);

                const actual = item.Actual || '-';
                const actualClass = actual === '-' ? 'pending' : 'actual-score';
                const dateDisplay = formatDate(item.MatchDate);

                row.innerHTML = `
                    <td>${item.HomeTeam} vs ${item.AwayTeam}</td>
                    <td>${dateDisplay}</td>
                    <td class="score">${item.PredictedScore}</td>
                    <td style="font-size:0.8em;">${formatWinProbs(item.WinProbs)}</td>
                    <td class="${actualClass}">${actual}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function showHeatmap(index) {
            const match = currentMatchdayData[index];
            if (!match || !match.ProbMatrix) {
                alert('Probability data not available for this match.');
                return;
            }

            document.getElementById('modal-title').textContent = `${match.HomeTeam} vs ${match.AwayTeam}`;
            const grid = document.getElementById('heatmap-grid');
            grid.innerHTML = '';

            grid.innerHTML += '<div class="heatmap-cell"></div>';
            for (let a = 0; a <= 5; a++) {
                grid.innerHTML += `<div class="heatmap-cell heatmap-header">${a}</div>`;
            }

            for (let h = 0; h <= 5; h++) {
                grid.innerHTML += `<div class="heatmap-cell heatmap-row-header">${h}</div>`;
                for (let a = 0; a <= 5; a++) {
                    const key = `${h}-${a}`;
                    const prob = match.ProbMatrix[key] || 0;
                    const color = getHeatmapColor(prob);
                    grid.innerHTML += `<div class="heatmap-cell" style="background:${color};" title="${key}: ${prob}%">${prob}%</div>`;
                }
            }

            document.getElementById('heatmap-modal').classList.add('active');
        }

        function getHeatmapColor(prob) {
            if (prob < 3) return '#fee0e0';
            if (prob < 6) return '#fff3cd';
            if (prob < 10) return '#d4edda';
            if (prob < 15) return '#a8e6a8';
            return '#6fdc6f';
        }

        function closeModal() {
            document.getElementById('heatmap-modal').classList.remove('active');
        }

        document.getElementById('heatmap-modal').addEventListener('click', function (e) {
            if (e.target === this) closeModal();
        });
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeModal();
        });

        loadData();
    </script>
</body>

</html>